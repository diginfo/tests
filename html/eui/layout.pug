- 
  /*
    Data available: 
    1. $.xx   (globals)
    2. fn.xx  (appfunc)
    3. codata:{}, mobile:bool, reps:{}, udata:{}, menus:[], lang:{}, req:{} 
  */

  /*
    EUI 1.5.4 Bugs
    1. Combobox keeps reloading.
  */

  if($.isdev) $.euiver='1.4.4'; else $.euiver='1.4.4'; 
  
  /*
  var nocache=false; if(req && req.query._nocache) nocache=true;
  function iscache(src){if(!nocache) return src; return src+'?_='+new Date().getTime().toString()}
  */
  
  // PAC 200325 - Force timestamp on <head> files using engine start date/time.
  function iscache(src){return src+'?_='+$.stats.start.getTime().toString()}
  
  udata = udata || {userid:''}
  $.planplus = $.planplus || false;
 
doctype html
html(lang="en-GB")
  head
    block head
      script(defer) function rm(){var elem = document.querySelector("script.rm"); if(elem) elem.parentNode.removeChild(elem);}
      if(req)
        script.rm.
          var dwap = {
            runmode   : '!{$.runmode}',
            planplus  : !{$.planplus},
            ronly     : false,
            euiver    : '!{$.euiver}',
            isdev     : !{$.isdev},
            debug     : !{$.debug},
            mobile    : !{$.mobile},
            mobile    : false, /* FORCE IT OFF FOR EASYUI */
            codata    : !{JSON.stringify($.codata)},
          };
  
          rm();
        
      meta(http-equiv='Content-Type' content='text/plain; charset=UTF-8')
      
      //-meta(http-equiv='Cache-Control' content='no-cache, must-revalidate')
      
      //-if(cache)
        meta(http-equiv='cache-control', content='max-age=0')
        meta(http-equiv='cache-control', content='no-cache')
        meta(http-equiv='expires', content='0')
        meta(http-equiv='expires', content='Tue, 01 Jan 1980 1:00:00 GMT')
        meta(http-equiv='pragma', content='no-cache')
      
      title=title
      
      -if(!udata || !udata.theme) udata.theme = 'default'
      -var epath = '/js3/jquery-easyui-'+$.euiver+'/';
      -var tpath=epath+'/themes/'+udata.theme+'/'

      link(rel="shortcut icon" href="/img/pure_icon.png" type="image/x-icon")
      link(rel='stylesheet' type='text/css' href=tpath+iscache('easyui.css'))
      //-if($.mobile)
        link(rel='stylesheet' type='text/css' href=epath+iscache('themes/mobile.css'))
      link(rel='stylesheet' type='text/css' href=epath+iscache('themes/icon.css'))

      script(type='text/javascript' src=epath+iscache('jquery.min.js'))
      script(type='text/javascript' src=epath+iscache('jquery.easyui.min.js'))
      
      //-if($.mobile)
        script(type='text/javascript' src=iscache(epath+'jquery.easyui.mobile.js'))
        script(defer) $.mobile.init();

      link(rel='stylesheet' type='text/css' href=iscache('/css/simplegrid.css'))
      link(rel='stylesheet' type='text/css' href=iscache('/css/main.css'))
      link(rel='stylesheet' type='text/css' href=iscache('/css/icons.css'))

      script(type='text/javascript' src=iscache('/js/eui.patches.js'))
      script(type='text/javascript' src=iscache('/js/eui.extend.js'))
      script(type='text/javascript' src=iscache('/js/datagrid-filter.js'))
      script(type='text/javascript' src=iscache('/js/main.js'))
      script(type='text/javascript' src=iscache('/js/upload.js'))
      script(type='text/javascript' src=iscache('/js/eui.qbe.js'))
      script(type='text/javascript' src=iscache('/js/qbedef.js'))     

      if($.isdev || udata.sysadm)
        script(defer).rm console.log('eui:'+dwap.euiver+' isdev:'+dwap.isdev+' mobile:'+dwap.mobile);rm();
      else
        script.rm $(document).on('contextmenu', function(e) {e.preventDefault()});rm();

      style.
        #content.__ form {
          pointer-events:none;
        } 
        
        #content.__ form .cbnav,
        #content.__ form input.fkey + .textbox.combo {
          pointer-events: auto;
        }
      
  
  body#cc.easyui-layout(lang=udata.language)
    block content
    div#_fragments_(style="display:none;")
    textarea#clipcopy(style="display:none;")
